<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Customs Clearance Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="chat-container">
        <h2>Intelligent Customs Clearance Assistant</h2>

        <div class="chat-box" id="chat-box">
            <div class="bot-message">ğŸ‘‹ Hello! I can help you with customs clearance, document verification, and import/export queries.</div>
        </div> -->

        <!-- ğŸ”Š Voice Chat Toggle -->
        <!-- <button id="voiceToggle" style="
            padding:8px 15px; 
            margin-top:10px; 
            border:none; 
            background:#2b82ff; 
            color:white; 
            border-radius:6px;
            cursor:pointer;
        ">
            ğŸ™ï¸ Voice: OFF
        </button>

        <audio id="audioPlayer"></audio>

        <div class="chat-controls">
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>

            <div class="upload-mini">
                <input type="file" id="fileInput" name="file" accept=".pdf,.docx,.jpg,.jpeg,.png" style="display:none;">
                <button type="button" onclick="document.getElementById('fileInput').click()">ğŸ“‚ Upload</button>
                <button type="button" onclick="uploadFile()">â¬†ï¸ Send</button>
            </div>
        </div>
    </div>

    <script>
        // --------------------------
        // ğŸ™ï¸ VOICE TOGGLE
        // --------------------------
        let voiceEnabled = false;
        let recognition;

        document.getElementById("voiceToggle").addEventListener("click", function () {
            voiceEnabled = !voiceEnabled;

            if (voiceEnabled) {
                this.innerText = "ğŸ™ï¸ Voice: ON";
                startVoiceRecognition();
            } else {
                this.innerText = "ğŸ™ï¸ Voice: OFF";
                if (recognition) recognition.stop();
            }
        });

        // --------------------------
        // ğŸ¤ Speech-To-Text
        // --------------------------
        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Your browser does not support voice recognition.");
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.lang = "en-IN";
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.start();

            recognition.onresult = function (event) {
                const text = event.results[0][0].transcript;
                console.log("ğŸ¤ Voice Input:", text);
                sendMessage(text);
            };

            recognition.onerror = () => recognition.stop();
            recognition.onend = () => { if (voiceEnabled) recognition.start(); };
        }

        // --------------------------
        // ğŸ”Š Text-to-Speech (Play TTS)
        // --------------------------
        function speakText(text) {
            fetch("/tts", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text })
            })
            .then(res => res.json())
            .then(data => {
                const player = document.getElementById("audioPlayer");
                player.src = data.audio_url;
                player.play();
            });
        }

        // --------------------------
        // ğŸ“© Chat Function
        // --------------------------
        function sendMessage(userText = null) {
            let userInput = userText || document.getElementById("user-input").value.trim();
            if (!userInput) return;

            let chatBox = document.getElementById("chat-box");

            let userMessage = document.createElement("div");
            userMessage.className = "user-message";
            userMessage.innerText = userInput;
            chatBox.appendChild(userMessage);

            fetch("/get", {
                method: "POST",
                body: new URLSearchParams({ msg: userInput }),
                headers: { "Content-Type": "application/x-www-form-urlencoded" }
            })
            .then(response => response.text())
            .then(botReply => {
                let botMessage = document.createElement("div");
                botMessage.className = "bot-message";
                botMessage.innerText = botReply;
                chatBox.appendChild(botMessage);

                chatBox.scrollTop = chatBox.scrollHeight;

                // â¤ Speak LLM response
                if (voiceEnabled) speakText(botReply);
            });

            document.getElementById("user-input").value = "";
        }

        // Enter key = send
        document.getElementById("user-input").addEventListener("keypress", function(event) {
            if (event.key === "Enter") sendMessage();
        });

        // --------------------------
        // ğŸ“¤ File Upload
        // --------------------------
        function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files.length) {
                alert("Please select a file!");
                return;
            }

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            let chatBox = document.getElementById("chat-box");
            let uploadMsg = document.createElement("div");
            uploadMsg.className = "bot-message";
            uploadMsg.innerText = "ğŸ“¤ Processing your document...";
            chatBox.appendChild(uploadMsg);

            fetch("/upload", { method: "POST", body: formData })
            .then(response => response.json())
            .then(data => {
                let result = "";

                if (data.error) {
                    result = "âŒ Error: " + data.error;
                } else {
                    result =
                        "âœ… Verification Result:\n" + data.verification + "\n\n" +
                        "ğŸ“„ Document Analysis:\n" + data.analysis;
                }

                let botMessage = document.createElement("div");
                botMessage.className = "bot-message";
                botMessage.innerText = result;
                chatBox.appendChild(botMessage);

                // Speak if voice mode is ON
                if (voiceEnabled) speakText(result);

                chatBox.scrollTop = chatBox.scrollHeight;
            });
        }
    </script>

</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Customs Clearance Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="chat-container">
        <h2>Intelligent Customs Clearance Assistant</h2>

        <div class="chat-box" id="chat-box">
            <div class="bot-message">ğŸ‘‹ Hello! I can help you with customs clearance, document verification, and import/export queries.</div>
        </div>

        <!-- ğŸ”Š Voice Chat Toggle -->
        <button id="voiceToggle" class="voice-btn">
            ğŸ™ï¸ Voice: OFF
        </button>

        <audio id="audioPlayer"></audio>

        <div class="chat-controls">
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>

            <div class="upload-mini">
                <input type="file" id="fileInput" name="file" accept=".pdf,.docx,.jpg,.jpeg,.png" style="display:none;">
                <button onclick="document.getElementById('fileInput').click()">ğŸ“‚ Upload</button>
                <button onclick="uploadFile()">â¬†ï¸ Send</button>
            </div>
        </div>
    </div>

    <!-- Load external JS file -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
